import{i as he,b as me,a as z,c as H,d as O,e as J,f as pe,g as ge,h as ve,j as xe,r as be,t as G,k as ye,l as je,m as _e,n as X,o as we,p as Ne,q as Se,s as $,u as o,L as P,B as S,v as R,w as Ae,x as U,y as D,z as A,A as Z,C as Ce,D as Fe,E as V,F,G as Be,H as K,I as T,J as Me,K as Le,M as ee,P as $e,N as De,O as Ee,Q as te,R as Pe,S as Ue,T as se,U as Te,V as Ve,W as I,X as Ie,Y as ne,Z as re,_ as qe,$ as ae,a0 as Re,a1 as Qe,a2 as Oe,a3 as ze,a4 as He,a5 as Ge,a6 as E,a7 as Ze}from"./index-mcMzom7c.js";import{r as y,g as We}from"./framer-motion-TJDGT-Cc.js";import{F as q,a as M}from"./FormElement-hTJ_OStP.js";var Xe="[object Number]";function Ye(r){return typeof r=="number"||he(r)&&me(r)==Xe}function ke(r,i){return r<i}function Je(r,i,c){for(var d=-1,u=r.length;++d<u;){var f=r[d],h=i(f);if(h!=null&&(m===void 0?h===h&&!z(h):c(h,m)))var m=h,g=f}return g}function Ke(r,i){return r&&r.length?Je(r,H(i),ke):void 0}var et="Expected a function";function tt(r){if(typeof r!="function")throw new TypeError(et);return function(){var i=arguments;switch(i.length){case 0:return!r.call(this);case 1:return!r.call(this,i[0]);case 2:return!r.call(this,i[0],i[1]);case 3:return!r.call(this,i[0],i[1],i[2])}return!r.apply(this,i)}}function st(r,i){var c=r.length;for(r.sort(i);c--;)r[c]=r[c].value;return r}function nt(r,i){if(r!==i){var c=r!==void 0,d=r===null,u=r===r,f=z(r),h=i!==void 0,m=i===null,g=i===i,v=z(i);if(!m&&!v&&!f&&r>i||f&&h&&g&&!m&&!v||d&&h&&g||!c&&g||!u)return 1;if(!d&&!f&&!v&&r<i||v&&c&&u&&!d&&!f||m&&c&&u||!h&&u||!g)return-1}return 0}function rt(r,i,c){for(var d=-1,u=r.criteria,f=i.criteria,h=u.length,m=c.length;++d<h;){var g=nt(u[d],f[d]);if(g){if(d>=m)return g;var v=c[d];return g*(v=="desc"?-1:1)}}return r.index-i.index}function at(r,i,c){i.length?i=O(i,function(f){return J(f)?function(h){return pe(h,f.length===1?f[0]:f)}:f}):i=[ge];var d=-1;i=O(i,ve(H));var u=xe(r,function(f,h,m){var g=O(i,function(v){return v(f)});return{criteria:g,index:++d,value:f}});return st(u,function(f,h){return rt(f,h,c)})}var it=/^\s+/,ot=be.parseInt;function Y(r,i,c){return c||i==null?i=0:i&&(i=+i),ot(G(r).replace(it,""),i||0)}function ie(r,i){var c=J(r)?ye:je;return c(r,tt(H(i)))}var lt=_e(function(r,i){if(r==null)return[];var c=i.length;return c>1&&X(r,i[0],i[1])?i=[]:c>2&&X(i[0],i[1],i[2])&&(i=[i[0]]),at(r,we(i,1),[])});const ct=lt;function ut(r,i){var c,d;Ne(1,arguments);var u=Se(r);if(isNaN(u.getTime()))throw new RangeError("Invalid time value");var f=String((c=i==null?void 0:i.format)!==null&&c!==void 0?c:"extended"),h=String((d=i==null?void 0:i.representation)!==null&&d!==void 0?d:"complete");if(f!=="extended"&&f!=="basic")throw new RangeError("format must be 'extended' or 'basic'");if(h!=="date"&&h!=="time"&&h!=="complete")throw new RangeError("representation must be 'date', 'time', or 'complete'");var m="",g="",v=f==="extended"?"-":"",x=f==="extended"?":":"";if(h!=="time"){var N=$(u.getDate(),2),C=$(u.getMonth()+1,2),b=$(u.getFullYear(),4);m="".concat(b).concat(v).concat(C).concat(v).concat(N)}if(h!=="date"){var j=u.getTimezoneOffset();if(j!==0){var _=Math.abs(j),p=$(Math.floor(_/60),2),l=$(_%60,2),a=j<0?"+":"-";g="".concat(a).concat(p,":").concat(l)}else g="Z";var t=$(u.getHours(),2),e=$(u.getMinutes(),2),n=$(u.getSeconds(),2),s=m===""?"":"T",w=[t,e,n].join(x);m="".concat(m).concat(s).concat(w).concat(g)}return m}const dt=()=>o.jsxs("header",{className:"space-x-32",children:[o.jsxs("span",{className:"space-x-16",children:[o.jsx(P,{to:"/admin/doors",children:o.jsx(S,{content:"Luker"})}),o.jsx(P,{to:"/admin/doors/new",children:o.jsx(S,{children:"Ny luke"})})]}),o.jsxs("span",{className:"space-x-16",children:[o.jsx(P,{to:"/admin/service_messages",children:o.jsx(S,{content:"Driftsmeldinger"})}),o.jsx(P,{to:"/admin/service_messages/new",children:o.jsx(S,{children:"Ny driftsmelding"})})]})]}),oe=async()=>await A.get("/admin/challenges").then(({data:r})=>Ce(r,"door")),Q=r=>R(["admin","challenges"],oe,{...r,staleTime:6e5}),le=r=>R(["admin","challenges"],oe,{staleTime:6e5,select:r?Ae(r):void 0}),ft=r=>A.get(`/admin/challenges/${Z(r)}/posts`).then(({data:i})=>i),ht=r=>R(["admin","posts",r],()=>ft(r),{staleTime:3e5}),mt=async r=>{if(r=Fe(r,["markdown_content","files"]),!V(r))return await A.post("/admin/challenge_markdown",{challenge:r}).then(({data:i})=>i)},pt=(r,i)=>R(["admin","challenges","preview",r],()=>mt(r),{staleTime:1/0,cacheTime:0,...i}),gt=()=>{const r=U();return D(["admin","challenges","create"],({challenge:i})=>A.post("/admin/challenges",{challenge:i}),{onSuccess:()=>{r.invalidateQueries("challenges"),r.invalidateQueries(["admin","challenges"])}})},vt=()=>{const r=U();return D(["admin","challenges","update"],({challenge:i})=>A.patch(`/admin/challenges/${Z(i.door)}`,{challenge:i}),{onSuccess:()=>{r.invalidateQueries("challenges"),r.invalidateQueries(["admin","challenges"])}})},xt=()=>{const r=U();return D(["admin","challenges","destroy"],async({door:i})=>Ye(i)&&A.delete(`/admin/challenges/${Z(i)}`),{onSuccess:()=>{r.invalidateQueries("challenges"),r.invalidateQueries(["admin","challenges"])}})},bt=()=>{const r=U();return D(["admin","serviceMessages","create"],i=>A.post("/admin/service_messages",i),{onSuccess:()=>{r.invalidateQueries("serviceMessages")}})},yt=()=>{const r=U();return D(["admin","serviceMessages","update"],({uuid:i,...c})=>A.patch(`/admin/service_messages/${i}`,c),{onSuccess:()=>{r.invalidateQueries("serviceMessages")}})},jt=()=>{const r=U();return D(["admin","serviceMessages","delete"],({uuid:i})=>A.delete(`/admin/service_messages/${i}`),{onSuccess:()=>{r.invalidateQueries("serviceMessages")}})},_t=()=>D(["admin","activeStorage","createBlob"],({blob:r,config:i})=>A.post("/rails/active_storage/direct_uploads",{blob:r},i).then(({data:c})=>c)),wt=()=>D(["admin","activeStorage","uploadFile"],({upload:{file:r,directUpload:i},config:c})=>A.put(i.url,r,{...c,headers:i.headers})),Nt=({door:r,setDoor:i})=>{const{data:c}=Q();return c?o.jsx("label",{className:"block space-x-8",children:o.jsx("select",{className:"form-select text-black",defaultValue:r,onChange:d=>i(parseInt(d.target.value)),children:F(ct(Be(K(c)),"door"),({door:d,title:u},f)=>o.jsx("option",{value:d,label:`Luke ${d}: ${u}`,children:`Luke ${d}: ${u}`},f))})}):null},St=()=>{var N;const r=T(),{search:i}=Me(),c=(N=i.match(/door=(?<door>\d+)/))==null?void 0:N.groups,{data:d}=Q(),u=y.useMemo(()=>Ke(K(d),"door"),[d]),{mutate:f,isLoading:h}=xt(),m=()=>{window.confirm(`Er du sikker pÃ¥ at du vil slette luke ${g} "${x==null?void 0:x.title}"?`)&&f({door:g},{onSuccess:()=>{v(void 0),r("/admin/doors")}})},[g,v]=y.useState(c&&parseInt(c.door));y.useLayoutEffect(()=>{v(C=>C??(u==null?void 0:u.door))},[v,u]);const{data:x}=le(g??(u==null?void 0:u.door));return Le(g)?null:o.jsxs("div",{className:"space-y-door-elements",children:[o.jsx(ee,{challenge:x,withoutInput:!0,preamble:o.jsxs("div",{className:"w-full flex justify-between mb-16",children:[o.jsx(Nt,{door:g,setDoor:v}),o.jsxs("div",{className:"space-x-16",children:[o.jsx(P,{to:`/admin/doors/${g}/edit`,children:o.jsx(S,{disabled:h,children:"Rediger luke"})}),o.jsx(S,{disabled:h,onClick:m,children:"Slett luke"})]})]})}),o.jsx($e,{door:g,usePosts:ht,withoutInput:!0})]})},At=y.memo(St),ce=()=>{const{data:r}=Q();return ie(De(1,25),i=>Ee(r,i))};var ue={exports:{}};(function(r,i){(function(c){r.exports=c()})(function(c){var d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function u(l,a){var t=l[0],e=l[1],n=l[2],s=l[3];t+=(e&n|~e&s)+a[0]-680876936|0,t=(t<<7|t>>>25)+e|0,s+=(t&e|~t&n)+a[1]-389564586|0,s=(s<<12|s>>>20)+t|0,n+=(s&t|~s&e)+a[2]+606105819|0,n=(n<<17|n>>>15)+s|0,e+=(n&s|~n&t)+a[3]-1044525330|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&s)+a[4]-176418897|0,t=(t<<7|t>>>25)+e|0,s+=(t&e|~t&n)+a[5]+1200080426|0,s=(s<<12|s>>>20)+t|0,n+=(s&t|~s&e)+a[6]-1473231341|0,n=(n<<17|n>>>15)+s|0,e+=(n&s|~n&t)+a[7]-45705983|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&s)+a[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,s+=(t&e|~t&n)+a[9]-1958414417|0,s=(s<<12|s>>>20)+t|0,n+=(s&t|~s&e)+a[10]-42063|0,n=(n<<17|n>>>15)+s|0,e+=(n&s|~n&t)+a[11]-1990404162|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&s)+a[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,s+=(t&e|~t&n)+a[13]-40341101|0,s=(s<<12|s>>>20)+t|0,n+=(s&t|~s&e)+a[14]-1502002290|0,n=(n<<17|n>>>15)+s|0,e+=(n&s|~n&t)+a[15]+1236535329|0,e=(e<<22|e>>>10)+n|0,t+=(e&s|n&~s)+a[1]-165796510|0,t=(t<<5|t>>>27)+e|0,s+=(t&n|e&~n)+a[6]-1069501632|0,s=(s<<9|s>>>23)+t|0,n+=(s&e|t&~e)+a[11]+643717713|0,n=(n<<14|n>>>18)+s|0,e+=(n&t|s&~t)+a[0]-373897302|0,e=(e<<20|e>>>12)+n|0,t+=(e&s|n&~s)+a[5]-701558691|0,t=(t<<5|t>>>27)+e|0,s+=(t&n|e&~n)+a[10]+38016083|0,s=(s<<9|s>>>23)+t|0,n+=(s&e|t&~e)+a[15]-660478335|0,n=(n<<14|n>>>18)+s|0,e+=(n&t|s&~t)+a[4]-405537848|0,e=(e<<20|e>>>12)+n|0,t+=(e&s|n&~s)+a[9]+568446438|0,t=(t<<5|t>>>27)+e|0,s+=(t&n|e&~n)+a[14]-1019803690|0,s=(s<<9|s>>>23)+t|0,n+=(s&e|t&~e)+a[3]-187363961|0,n=(n<<14|n>>>18)+s|0,e+=(n&t|s&~t)+a[8]+1163531501|0,e=(e<<20|e>>>12)+n|0,t+=(e&s|n&~s)+a[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,s+=(t&n|e&~n)+a[2]-51403784|0,s=(s<<9|s>>>23)+t|0,n+=(s&e|t&~e)+a[7]+1735328473|0,n=(n<<14|n>>>18)+s|0,e+=(n&t|s&~t)+a[12]-1926607734|0,e=(e<<20|e>>>12)+n|0,t+=(e^n^s)+a[5]-378558|0,t=(t<<4|t>>>28)+e|0,s+=(t^e^n)+a[8]-2022574463|0,s=(s<<11|s>>>21)+t|0,n+=(s^t^e)+a[11]+1839030562|0,n=(n<<16|n>>>16)+s|0,e+=(n^s^t)+a[14]-35309556|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^s)+a[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,s+=(t^e^n)+a[4]+1272893353|0,s=(s<<11|s>>>21)+t|0,n+=(s^t^e)+a[7]-155497632|0,n=(n<<16|n>>>16)+s|0,e+=(n^s^t)+a[10]-1094730640|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^s)+a[13]+681279174|0,t=(t<<4|t>>>28)+e|0,s+=(t^e^n)+a[0]-358537222|0,s=(s<<11|s>>>21)+t|0,n+=(s^t^e)+a[3]-722521979|0,n=(n<<16|n>>>16)+s|0,e+=(n^s^t)+a[6]+76029189|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^s)+a[9]-640364487|0,t=(t<<4|t>>>28)+e|0,s+=(t^e^n)+a[12]-421815835|0,s=(s<<11|s>>>21)+t|0,n+=(s^t^e)+a[15]+530742520|0,n=(n<<16|n>>>16)+s|0,e+=(n^s^t)+a[2]-995338651|0,e=(e<<23|e>>>9)+n|0,t+=(n^(e|~s))+a[0]-198630844|0,t=(t<<6|t>>>26)+e|0,s+=(e^(t|~n))+a[7]+1126891415|0,s=(s<<10|s>>>22)+t|0,n+=(t^(s|~e))+a[14]-1416354905|0,n=(n<<15|n>>>17)+s|0,e+=(s^(n|~t))+a[5]-57434055|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~s))+a[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,s+=(e^(t|~n))+a[3]-1894986606|0,s=(s<<10|s>>>22)+t|0,n+=(t^(s|~e))+a[10]-1051523|0,n=(n<<15|n>>>17)+s|0,e+=(s^(n|~t))+a[1]-2054922799|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~s))+a[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,s+=(e^(t|~n))+a[15]-30611744|0,s=(s<<10|s>>>22)+t|0,n+=(t^(s|~e))+a[6]-1560198380|0,n=(n<<15|n>>>17)+s|0,e+=(s^(n|~t))+a[13]+1309151649|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~s))+a[4]-145523070|0,t=(t<<6|t>>>26)+e|0,s+=(e^(t|~n))+a[11]-1120210379|0,s=(s<<10|s>>>22)+t|0,n+=(t^(s|~e))+a[2]+718787259|0,n=(n<<15|n>>>17)+s|0,e+=(s^(n|~t))+a[9]-343485551|0,e=(e<<21|e>>>11)+n|0,l[0]=t+l[0]|0,l[1]=e+l[1]|0,l[2]=n+l[2]|0,l[3]=s+l[3]|0}function f(l){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=l.charCodeAt(t)+(l.charCodeAt(t+1)<<8)+(l.charCodeAt(t+2)<<16)+(l.charCodeAt(t+3)<<24);return a}function h(l){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=l[t]+(l[t+1]<<8)+(l[t+2]<<16)+(l[t+3]<<24);return a}function m(l){var a=l.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,s,w,B,L;for(e=64;e<=a;e+=64)u(t,f(l.substring(e-64,e)));for(l=l.substring(e-64),n=l.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)s[e>>2]|=l.charCodeAt(e)<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(u(t,s),e=0;e<16;e+=1)s[e]=0;return w=a*8,w=w.toString(16).match(/(.*?)(.{0,8})$/),B=parseInt(w[2],16),L=parseInt(w[1],16)||0,s[14]=B,s[15]=L,u(t,s),t}function g(l){var a=l.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,s,w,B,L;for(e=64;e<=a;e+=64)u(t,h(l.subarray(e-64,e)));for(l=e-64<a?l.subarray(e-64):new Uint8Array(0),n=l.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)s[e>>2]|=l[e]<<(e%4<<3);if(s[e>>2]|=128<<(e%4<<3),e>55)for(u(t,s),e=0;e<16;e+=1)s[e]=0;return w=a*8,w=w.toString(16).match(/(.*?)(.{0,8})$/),B=parseInt(w[2],16),L=parseInt(w[1],16)||0,s[14]=B,s[15]=L,u(t,s),t}function v(l){var a="",t;for(t=0;t<4;t+=1)a+=d[l>>t*8+4&15]+d[l>>t*8&15];return a}function x(l){var a;for(a=0;a<l.length;a+=1)l[a]=v(l[a]);return l.join("")}x(m("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function l(a,t){return a=a|0||0,a<0?Math.max(a+t,0):Math.min(a,t)}ArrayBuffer.prototype.slice=function(a,t){var e=this.byteLength,n=l(a,e),s=e,w,B,L,W;return t!==c&&(s=l(t,e)),n>s?new ArrayBuffer(0):(w=s-n,B=new ArrayBuffer(w),L=new Uint8Array(B),W=new Uint8Array(this,n,w),L.set(W),B)}}();function N(l){return/[\u0080-\uFFFF]/.test(l)&&(l=unescape(encodeURIComponent(l))),l}function C(l,a){var t=l.length,e=new ArrayBuffer(t),n=new Uint8Array(e),s;for(s=0;s<t;s+=1)n[s]=l.charCodeAt(s);return a?n:e}function b(l){return String.fromCharCode.apply(null,new Uint8Array(l))}function j(l,a,t){var e=new Uint8Array(l.byteLength+a.byteLength);return e.set(new Uint8Array(l)),e.set(new Uint8Array(a),l.byteLength),t?e:e.buffer}function _(l){var a=[],t=l.length,e;for(e=0;e<t-1;e+=2)a.push(parseInt(l.substr(e,2),16));return String.fromCharCode.apply(String,a)}function p(){this.reset()}return p.prototype.append=function(l){return this.appendBinary(N(l)),this},p.prototype.appendBinary=function(l){this._buff+=l,this._length+=l.length;var a=this._buff.length,t;for(t=64;t<=a;t+=64)u(this._hash,f(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},p.prototype.end=function(l){var a=this._buff,t=a.length,e,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s;for(e=0;e<t;e+=1)n[e>>2]|=a.charCodeAt(e)<<(e%4<<3);return this._finish(n,t),s=x(this._hash),l&&(s=_(s)),this.reset(),s},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(l){return this._buff=l.buff,this._length=l.length,this._hash=l.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(l,a){var t=a,e,n,s;if(l[t>>2]|=128<<(t%4<<3),t>55)for(u(this._hash,l),t=0;t<16;t+=1)l[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(e[2],16),s=parseInt(e[1],16)||0,l[14]=n,l[15]=s,u(this._hash,l)},p.hash=function(l,a){return p.hashBinary(N(l),a)},p.hashBinary=function(l,a){var t=m(l),e=x(t);return a?_(e):e},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(l){var a=j(this._buff.buffer,l,!0),t=a.length,e;for(this._length+=l.byteLength,e=64;e<=t;e+=64)u(this._hash,h(a.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(a.buffer.slice(e-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(l){var a=this._buff,t=a.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,s;for(n=0;n<t;n+=1)e[n>>2]|=a[n]<<(n%4<<3);return this._finish(e,t),s=x(this._hash),l&&(s=_(s)),this.reset(),s},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var l=p.prototype.getState.call(this);return l.buff=b(l.buff),l},p.ArrayBuffer.prototype.setState=function(l){return l.buff=C(l.buff,!0),p.prototype.setState.call(this,l)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(l,a){var t=g(new Uint8Array(l)),e=x(t);return a?_(e):e},p})})(ue);var Ct=ue.exports;const Ft=We(Ct),Bt=()=>{const r=y.useRef(!0),i=y.useCallback(()=>r.current,[]);return y.useEffect(()=>()=>void(r.current=!1),[]),i};let k=0;const Mt=({challenge:r,register:i,setValue:c,className:d})=>{i("files");const{mutateAsync:u}=_t(),{mutateAsync:f}=wt(),[h,m]=y.useState(F(r.files,b=>({...b,fileId:k++})));y.useEffect(()=>{c("files",F(h,"signed_id"))},[c,h]);const[g,v]=y.useState({}),x=Bt(),N=async b=>{await Promise.all(F(b,async j=>{const _=k++;v(e=>({...e,[_]:{progress:0}}));const p={filename:j.name,content_type:j.type,byte_size:j.size,checksum:btoa(Ft.ArrayBuffer.hash(await j.arrayBuffer(),!0))},{signed_id:l,direct_upload:a}=await u({blob:p});!x()||(m(e=>[...e,{signed_id:l,filename:j.name,fileId:_}]),await f({upload:{file:j,directUpload:a},config:{onUploadProgress:({loaded:e,total:n})=>{x()&&Ue(n)&&v(s=>({...s,[_]:{progress:e/n}}))}}}),!x())||v(e=>({...e,[_]:{progress:1}}))}))},C=y.useRef(null);return o.jsxs("div",{className:te("space-y-4",d),children:[o.jsxs(q,{label:"Filer",note:"husk Ã¥ dobbeltsjekke riktig filnavn i markdown",children:[o.jsx("input",{ref:C,className:"hidden",type:"file",multiple:!0,onChange:({target:{files:b}})=>b&&N(b)}),o.jsx(S,{className:"block form-input",type:"button",content:"Velg filer...",onClick:()=>{var b;return(b=C.current)==null?void 0:b.click()}})]}),o.jsx("div",{className:"grid grid-cols-4 gap-4",children:F(h,({filename:b,signed_id:j,fileId:_})=>{var l;const p=((l=g[_])==null?void 0:l.progress)??1;return o.jsxs("span",{className:"relative overflow-hidden p-2 border-2 rounded-md border-yellow-400 text-center",children:[p<1&&o.jsx("div",{style:{width:`calc(${p*100}% + ${p*.5}rem)`},className:"absolute -top-2 -left-2 h-[calc(100%+.5rem)] bg-purple-400/20"}),o.jsx("span",{className:"inline-block w-[calc(100%-1.5rem)] line-clamp-1",children:b}),o.jsx(Pe,{className:"absolute top-0 right-4 h-full w-6 cursor-pointer",onClick:()=>m(a=>ie(a,{signed_id:j}))})]},j)})})]})},Lt=({challenge:r,newForm:i=!1,submit:c})=>{const[d,u]=y.useState(!1),{register:f,handleSubmit:h,setValue:m,getValues:g,watch:v,formState:{dirtyFields:{door:x}}}=se({defaultValues:{...r,files:F(r.files,"signed_id")}}),[N,C]=y.useState(),{data:b}=pt(N,{enabled:d}),j=()=>{u(t=>(C(t?void 0:g()),!t))},_=ce(),p=v("door"),l=r.active_from??Te(x?p:r.door),a=r.active_to??Ve();return o.jsxs("div",{className:"space-y-16",children:[o.jsxs("form",{className:"space-y-8",onSubmit:h(t=>c({...t,door:x?p:r.door})),children:[o.jsxs("div",{className:"space-x-8",children:[o.jsx(S,{type:"submit",children:"Lagre"}),o.jsx(S,{type:"button",className:"uppercase",onClick:j,children:d?"Rediger":"ForhÃ¥ndsvisning"})]}),o.jsxs("div",{className:te("grid grid-cols-3 gap-8",d&&"hidden"),children:[i&&o.jsx(q,{label:"Luke",className:"col-span-3",children:o.jsx("select",{className:"block form-select text-black",defaultValue:_[0],...f("door",{required:!0}),children:F(_,t=>o.jsx("option",{value:t,label:G(t)},t))})}),o.jsx(M,{label:"Tittel",type:"text",defaultValue:r.title,...f("title",{required:!0})}),o.jsx(M,{label:"Forfatter",type:"text",defaultValue:r.author,...f("author",{required:!0})}),o.jsx(M,{label:"Svar",note:"omringende whitespace blir ignorert",type:"text",defaultValue:r.answer,...f("answer",{required:!0})}),o.jsx(M,{label:"Aktiv fra",disabled:!0,type:"datetime-local",value:I(l)}),o.jsx(M,{label:"Aktiv til",disabled:!0,type:"datetime-local",value:I(a)}),o.jsx(Mt,{challenge:r,register:f,setValue:m,className:"col-span-3"}),o.jsx("div",{className:"col-span-3",children:o.jsx(q,{label:"Innhold",note:"tittel-elementet blir erstattet med tittel fra over",className:"col-span-3",children:o.jsx(Ie,{className:"block w-full form-textarea text-black",rows:5,defaultValue:r.markdown_content,...f("markdown_content",{required:!0})})})})]})]}),d&&N&&b&&o.jsx(ee,{withoutInput:!0,challenge:{...N,content:b.html}})]})},de=y.memo(Lt),$t=()=>{const{door:r}=ne(),i=re(r,parseInt),c=T(),{data:d,isLoading:u}=le(i),{mutate:f}=vt(),h=m=>{f({challenge:m},{onSuccess:()=>c(`/admin/doors?door=${m.door}`)})};return y.useLayoutEffect(()=>{(!i||!u&&!d)&&c("/admin/doors/new")},[i,u,d,c]),!i||u||!d?null:o.jsxs("div",{className:"space-y-16",children:[o.jsx("div",{className:"text-center",children:o.jsxs("span",{className:"text-4xl font-semibold",children:["Luke ",i]})}),o.jsx(de,{challenge:d,submit:h})]})},Dt=({serviceMessage:r,newForm:i=!1,submit:c})=>{const{register:d,handleSubmit:u,setValue:f}=se({defaultValues:{...r,...!i&&{resolved_at:I(r.resolved_at??ut(new Date))}}}),{data:h}=Q({select:m=>F(qe(m),Y)});return o.jsx("div",{className:"space-y-16",children:o.jsxs("form",{className:"space-y-8",onSubmit:u(c),children:[o.jsx("div",{className:"space-x-8",children:o.jsx(S,{type:"submit",children:"Lagre"})}),o.jsxs("div",{className:"grid grid-cols-3 gap-8",children:[o.jsx(M,{label:"Innhold",type:"text",labelClassName:"col-span-3",className:"w-full",defaultValue:r.content,...d("content",{required:!0})}),!i&&o.jsx(M,{label:"LÃ¸sning",type:"text",labelClassName:"col-span-3",className:"w-full",defaultValue:r.resolution_content??"",...d("resolution_content",{setValueAs:m=>V(m)?null:m})}),o.jsx(q,{label:"Luke",className:"col-span-3",defaultValue:r.resolution_content??"",children:o.jsxs("select",{className:"block form-select text-black",defaultValue:r.door??void 0,...d("door",{setValueAs:m=>V(m)?void 0:Y(m)}),children:[o.jsx("option",{label:"-",value:""}),F(h,m=>o.jsx("option",{label:G(m),value:m},m))]})}),!i&&o.jsxs(o.Fragment,{children:[o.jsx(M,{label:"Opprettet",type:"datetime-local",value:I(r.created_at??""),disabled:!0}),o.jsxs("div",{children:[o.jsx(M,{label:"LÃ¸sningstidspunkt",type:"datetime-local",...d("resolved_at")}),o.jsx(S,{type:"button",className:"!text-xs",onClick:()=>f("resolved_at",null),content:"Nullstill"})]})]})]})]})})},fe=y.memo(Dt),Et=()=>{const{uuid:r}=ne(),i=T(),{data:c,isLoading:d}=ae({select:h=>Re(h,{uuid:r})}),{mutate:u}=yt(),f=h=>{re(r,m=>u({uuid:m,service_message:h},{onSuccess:()=>i("/admin/service_messages")}))};return y.useEffect(()=>{!d&&!c&&i("/admin/service_messages/new")},[d,c,i]),d||!c?null:o.jsxs("div",{className:"space-y-16",children:[o.jsx("div",{className:"text-center",children:o.jsx("span",{className:"text-4xl font-semibold",children:"Endre driftsmelding"})}),o.jsx(fe,{serviceMessage:c,submit:f})]})},Pt=()=>{const r=T(),{mutate:i}=gt(),c=u=>{i({challenge:u},{onSuccess:()=>r(`/admin/doors?door=${u.door}`)})},d=ce();return V(d)?o.jsx("div",{className:"text-center",children:o.jsx("span",{className:"text-4xl font-semibold",children:"Ingen ledige luker!"})}):o.jsxs("div",{className:"space-y-16",children:[o.jsx("div",{className:"text-center",children:o.jsx("span",{className:"text-4xl font-semibold",children:"Ny luke"})}),o.jsx(de,{newForm:!0,challenge:{door:d[0],title:"",author:"",answer:"",markdown_content:"",files:[]},submit:c})]})},Ut=()=>{const r=T(),{mutate:i}=bt(),c=d=>{i({service_message:d},{onSuccess:()=>r("/admin/service_messages")})};return o.jsxs("div",{className:"space-y-16",children:[o.jsx("div",{className:"text-center",children:o.jsx("span",{className:"text-4xl font-semibold",children:"Ny driftsmelding"})}),o.jsx(fe,{newForm:!0,serviceMessage:{content:"",resolution_content:null,resolved_at:null,door:null},submit:c})]})},Tt=()=>{const{data:r,isLoading:i}=ae(),{mutate:c}=jt(),d=u=>{window.confirm("Sikker pÃ¥ at du vil slette driftsmelding?")&&c({uuid:u})};return i?null:o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"text-center",children:o.jsx(Qe,{children:"Driftsmeldinger"})}),o.jsx("div",{className:"grid grid-cols-1 gap-12 justify-items-center",children:V(r)?o.jsx("div",{children:"ð Ingen driftsmeldinger. Livet er herlig! ð"}):F(r,u=>o.jsxs("div",{className:"w-full max-w-[40rem]",children:[o.jsxs("div",{className:"m-4 space-x-8",children:[o.jsx(P,{to:`/admin/service_messages/${u.uuid}/edit`,children:o.jsx(S,{content:"Rediger"})}),o.jsx(S,{content:"Slett",onClick:()=>d(u.uuid)})]}),o.jsx(Oe,{serviceMessage:u})]},u.uuid))})]})},Rt=()=>{const r=T(),{data:i,isLoading:c}=ze();return y.useLayoutEffect(()=>{!c&&(!i||!i.is_admin)&&r("/")},[c,i,r]),!c&&(!i||!i.is_admin)?null:o.jsxs(He,{className:"py-24 px-16 md:px-24 mx-8 md:mx-16 bg-purple-700 rounded-md space-y-16",children:[o.jsx(dt,{}),o.jsxs(Ge,{children:[o.jsx(E,{path:"doors",element:o.jsx(At,{})}),o.jsx(E,{path:"doors/new",element:o.jsx(Pt,{})}),o.jsx(E,{path:"doors/:door/edit",element:o.jsx($t,{})}),o.jsx(E,{path:"service_messages",element:o.jsx(Tt,{})}),o.jsx(E,{path:"service_messages/new",element:o.jsx(Ut,{})}),o.jsx(E,{path:"service_messages/:uuid/edit",element:o.jsx(Et,{})}),o.jsx(E,{element:o.jsx(Ze,{to:"doors"})})]})]})};export{Rt as default};
